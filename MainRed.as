package {	import Utlis.*;		import com.blixtsystems.audio.MixerShader;	import com.pimedius.MixRecorder;		import components.CustomSound;	import components.CustomSoundEvent;	import components.SoundButton;	import components.SoundButtonEvent;		import flash.display.MovieClip;	import flash.events.Event;	import flash.events.KeyboardEvent;	import flash.events.MouseEvent;	import flash.events.ProgressEvent;	import flash.media.Sound;	import flash.media.SoundChannel;	import flash.media.SoundTransform;	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.net.registerClassAlias;	public class Main extends MovieClip {				static const BUFFER_SIZE:int = 2048;				var soundArray:Array;		var soundButtonArray:Array;		var playingQueue:Array;				var s1:Sound;		var s2:Sound;		var channel1:SoundChannel;		var channel2:SoundChannel;				var recorder:MixRecorder;		var xmlData:XML;		var myLoader:URLLoader;				private var columns:int;		private var padding:int;		private var horizontal_align:Boolean;		private var vertical_align:Boolean;		private var scale:int;				var soundButtonsHolder:MovieClip;				public function Main() {			// constructor code									recorder=new MixRecorder();			soundButtonArray=new Array();			soundArray=new Array();			playingQueue=new Array();						soundButtonsHolder=new MovieClip();			addChild(soundButtonsHolder);			//			play_btn1.addEventListener(MouseEvent.CLICK, onClickPlay1);//			play_btn2.addEventListener(MouseEvent.CLICK, onClickPlay2);			record_btn.addEventListener(MouseEvent.CLICK, onClickRecord);			stopRec_btn.addEventListener(MouseEvent.CLICK, onClickStopRecord);			playRecorded_btn.addEventListener(MouseEvent.CLICK, onClickPlayrecorded);			convert_btn.addEventListener(MouseEvent.CLICK, onClickConvert);			statusTxt.text="";						myLoader = new URLLoader();			myLoader.load(new URLRequest("content.xml"));			myLoader.addEventListener(Event.COMPLETE, processXML);		}				function processXML(e:Event):void {			xmlData = new XML(e.target.data);			//trace(xmlData.config);						columns=parseInt(xmlData.config.columns);			padding=parseInt(xmlData.config.padding);						if(xmlData.config.horizontal_align=="true"){				horizontal_align=true;			}else{				horizontal_align=false;			}						if(xmlData.config.vertical_align=="true"){				vertical_align=true;			}else{				vertical_align=false;			}			scale=parseFloat(xmlData.config.scale);			setupButtons();					}						function setupButtons():void{			for(var i=0; i<xmlData.sound.length();i++){				soundButtonArray.push(new SoundButton(soundButtonArray.length, xmlData.sound[i].title.toString(), xmlData.sound[i].key.toString(), false, parseFloat(xmlData.sound[i].volume), parseFloat(xmlData.sound[i].panning) ));				var current=soundButtonArray.length-1;				soundButtonArray[current].x=i*(soundButtonArray[current].width+padding);				soundButtonsHolder.addChild(soundButtonArray[current]);				soundButtonArray[current].addEventListener(SoundButtonEvent.MOUSE_DOWN,soundButtonPressed);				soundArray.push(new CustomSound(current,new URLRequest(xmlData.sound[i].path.toString())));			}						for(i=0; i<xmlData.loop.length();i++){				soundButtonArray.push(new SoundButton(soundButtonArray.length, xmlData.loop[i].title.toString(), xmlData.loop[i].key.toString(), true, parseFloat(xmlData.sound[i].volume), parseFloat(xmlData.sound[i].panning) ));				current=soundButtonArray.length-1;				soundButtonArray[current].x=i*(soundButtonArray[current].width+padding);				soundButtonArray[current].y=(soundButtonArray[current].height+padding);				soundButtonsHolder.addChild(soundButtonArray[current]);				soundButtonArray[current].addEventListener(SoundButtonEvent.MOUSE_DOWN,soundButtonPressed);				soundArray.push(new CustomSound(current,new URLRequest(xmlData.loop[i].path.toString())));			}			addKeyListener();		}				function addKeyListener():void{			stage.addEventListener(KeyboardEvent.KEY_UP, keyDownListener);		}				function removeKeyListener():void{			stage.removeEventListener(KeyboardEvent.KEY_UP, keyDownListener);		}				private function keyDownListener(e:KeyboardEvent):void {			var character:String = String.fromCharCode(e.charCode);			for(var i=0;i<soundButtonArray.length;i++){				var tempId:String=soundButtonArray[i].keyValue;				if(tempId==character || tempId.toLowerCase()==character){					if(soundButtonArray[i].looping && soundButtonArray[i].playingState){						soundButtonArray[i].switchState();						stopSounds(soundButtonArray[i].id);					}else{												soundButtonArray[i].switchState();						addSoundToQueue(soundArray[i],soundButtonArray[i].looping);					}					break;				}			}						}				function soundButtonPressed(e:SoundButtonEvent):void{			trace("=========\nPRESSED")			if(e.target.looping && e.target.playingState){				stopSounds(e.target.id);				e.target.switchState();				trace("btn off");			}else{				addSoundToQueue(soundArray[e.target.id],e.target.looping);				e.target.switchState();				trace("btn on");			}		}				function stopSounds(id:int):void{			for(var i=0;i<playingQueue.length;i++){				if(playingQueue[i].id==id){					playingQueue[i].removeEventListener(CustomSoundEvent.COMPLETE,queueSoundComplete);					playingQueue[i].addEventListener(CustomSoundEvent.STOPED,queueSoundStoped);					playingQueue[i].stopSound();					break;				}			}		}				function addSoundToQueue(snd:CustomSound,looping:Boolean=false):void{			var q_sound:CustomSound = new CustomSound(snd.id);			q_sound.sound=new Sound(new URLRequest(snd.path));			q_sound.addEventListener(CustomSoundEvent.COMPLETE,queueSoundComplete);			playingQueue.push(q_sound);			q_sound.queueId=playingQueue.length-1;						q_sound.playSound(looping);			recorder.addSound(q_sound.sound);		}				function queueSoundComplete(e:CustomSoundEvent):void{//			trace("============");//			trace("COMPLETE")			e.target.removeEventListener(CustomSoundEvent.COMPLETE,queueSoundComplete);			for(var i=0;i<playingQueue.length;i++){				if(playingQueue[i]==e.target){					var doesLoop=playingQueue[i].loop;					var loopId=playingQueue[i].id;					recorder.removeSound(playingQueue[i].sound);					playingQueue.splice(i,1);					if(doesLoop){						addSoundToQueue(soundArray[loopId],true);					}					break;				}			}		}				function queueSoundStoped(e:CustomSoundEvent):void{			e.target.removeEventListener(CustomSoundEvent.STOPED,queueSoundStoped);						for(var i=0;i<playingQueue.length;i++){				if(playingQueue[i]==e.target){					var doesLoop=playingQueue[i].loop;					var loopId=playingQueue[i].id;					recorder.removeSound(playingQueue[i].sound);					playingQueue.splice(i,1);					break;				}			}		}				function onClickRecord(e:MouseEvent):void{			recorder.startRecording();		}				function onClickStopRecord(e:MouseEvent):void{			recorder.stopRecording();		}				function onClickPlayrecorded(e:MouseEvent):void{			recorder.playRecorded();		}				function onClickConvert(e:MouseEvent):void{			recorder.convertToMP3();					}	}}